# Прошивка и настройка квадрокоптера после сборки своими руками

Если при подключении квадрокоптера к компьютеру он не видит полетный контроллер, то вам нужно сделать следующее:

- Качаем по ссылке https://www.st.com/en/development-tools/stsw-stm32102.html STM32 Virtual COM Port Driver — там нужно согласиться на использование драйвера и ввести свою почту, на которую придет ссылка для скачивания. Без этого драйвера вы не подключитесь ни к одному конфигуратору. Устанавливаем драйвер. Откройте файл Readme в архиве — там написано в разделе «How to use», чтобывы зашли в директорию установки и запустили файл dpinst_x86.exe или dpinst_amd64.exe.
- Если это не помогло и вы намудрили с драйверами, попробуйте поставить прошлую версию драйвера. Более подробно в статье:

# Прошивка регуляторов оборотов в BLHeliSuite
Сначала нам нужно открыть BLHeliSuite и прошить регуляторы оборотов. На нужна версия без 32 и на момент опубликования, она называлась BLHeliSuite16714901.

Запускаем и открываем. Сверху выбираем для Cleanflight:

<img width="772" height="505" alt="image" src="https://github.com/user-attachments/assets/f835f007-9a0a-47a2-8d08-be1b8ec3132e" />

Внизу выбираем нужный порт и нажимаем Read Setup, чтобы прочитать настройки.



Программа скажет, что настройки прочитаны успешно:
<img width="768" height="498" alt="image" src="https://github.com/user-attachments/assets/495fb8d7-aa55-4edd-b837-4027bbcb130d" />


Нажимаем Flash BLHeli:
<img width="769" height="502" alt="image" src="https://github.com/user-attachments/assets/7de7e022-7fc7-4031-a29e-69a0c7162321" />


В конце программа сообщит, что все 4 регулятора оборотов прошиты:
<img width="765" height="502" alt="image" src="https://github.com/user-attachments/assets/c191ff9e-f0d9-44f5-b00e-a4b7ef260d6d" />


## Вкладка Конфигурация

<img width="1915" height="971" alt="image" src="https://github.com/user-attachments/assets/577a70bb-3720-42cb-ad24-7948659bc2fe" />

<img width="1919" height="1036" alt="image" src="https://github.com/user-attachments/assets/122f3516-f28a-4e66-a570-44b8fd99c46d" />


Что на изображениях:

1) Протокол для общения Полетный контроллер — регуляторы оборотов: ставим DSHOT600;
2) У моторов в сборке 14 магнитов в колоколе. Если вы используете другие двигатели, то считайте;
3) Частота обновления гироскопа. Ставим 8kHz;
4) Частота обновления ПИДов: ставим 8kHz;
5) Включаем акселерометр;
6) Максимальный наклон квадрокоптера. Ставим 180, тогда вы сможете заармить дрон почти в любом положении.

Блок «Приемник»: здесь выбираем строчку «Приемник с последовательной передачей данных«. Ниже выбираем «SBUS«, так как приемник у нас работает на этом протоколе.

Блок «Прочий функционал»: включаем строчки, как на скрине. Если планируете подключить адресную светодиодную ленту, то включаем и LED_STRIP. Остальное включается под индивидуальные задачи и сейчас их включать не требуется.

Жмем «Сохранить и перезагрузить«.



### Вкладка Питание и батарея

<img width="848" height="568" alt="image" src="https://github.com/user-attachments/assets/d6a5fc82-3c1e-4982-8547-8bad2d1e2d28" />

Здесь все стандартно — просто настраиваем характеристики ваших аккумуляторов.

Жмем «Сохранить и перезагрузить«.

#### Вкладка Приемник

<img width="1917" height="1040" alt="image" src="https://github.com/user-attachments/assets/7f0f43ed-a683-4dc9-b62d-94e8a110f788" />

Таблица каналов выбирается и прописывается исходя из таблицы каналов вашей аппаратуры. Данный дрон управляется с помощью аппаратуры управления Taranis QX7 и у него по умолчанию таблица TAER1234. Ее можно менять непосредственно в самой аппаратуре.

Для проверки, что все работает: подключаем аккумулятор и аппаратуру управления. Двигаем всеми стиками и тумблерами в разные стороны. Разноцветные полоски должны реагировать на каждое движение элементов пульта.

Если вы используете аппаратуру Taranis, то скорее всего у вас тут не будут реагировать тумблеры. Для этого нужно зайти в меню, дойти до MIXER и назначить каналу тумблер. После этого, у вас начнет отображаться 5 канал в Betaflight и будет реагировать на переключения.


# Вкладка Моторы
Здесь нам нужно проверить направление моторов. Переключаем тумблер 1 и по очереди поднимаем ползунок каждого двигателя, перед этим подключив аккумулятор и обязательно сняв пропеллеры. Если все хорошо и каждый мотор крутится в свою сторону (как показано на схеме выше), то приступаем к калибровке, если нет, то заходим в BLHeli и меняем направление на Reversed.

- При использовании протоколов DSHOT, калибровку делать нет необходимости. Но если вы используете, например, Multishot, то калибровка нужна.

<img width="764" height="617" alt="image" src="https://github.com/user-attachments/assets/41615a59-2c36-477a-b116-9baff7bc60ac" />

Калибровка:

1. Переключаем тумблер 1;
2. Отключаем аккумулятор;
3. Поднимаем ползунок 2 на самый верх;
4. Подключаем аккумулятор — регуляторы пропищат;
5. Резко переводим ползунок в нижнее положение — регуляторы снова пропищат;
6. Переподключаем аккумулятор.



